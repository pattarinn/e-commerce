<p id="notice"><%= notice %></p>
<div class="col">
  <h1>Products</h1>
  <table class="table table-hover">
    <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Status</th>
      <th>Categories</th>
      <th>Stock</th>
      <th>Price</th>
      <th colspan="3"></th>
    </tr>
    </thead>

    <tbody>
    <% @products.each do |product| %>
      <tr>
        <td><%= product.title %></td>
        <td><%= product.description %></td>
        <td><%=product.status %></td>
        <td>
          <% if product.categories.present? %>
            <% product.categories.each do |category| %>
              <%= link_to "#{category.name}", category_path(category) %>
            <% end %>
          <% else %>
            <div>
              NA
            </div>
          <% end %>
        </td>
        <!--                <td><%#= product.categories&.map(&:name)&.join(',').presence || 'NA' %></td>-->

        <td><%= product.stock %></td>
        <td><%= product.price %></td>
        <td>
          <a class="fas fa-eye" href=<%= product_path(product) %>></a>
          <% if admin_signed_in? %>
            <a class="fas fa-pen" href=<%= edit_product_path(product) %>></a>
            <%= link_to 'Delete', product, method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
          <% end %>
          </tr>
    <% end %>
    </tbody>
  </table>
  <br>
  <% if admin_signed_in? %>
    <%= link_to 'New Product', new_product_path %>
    <%= link_to 'Sign Out', destroy_admin_session_path, method: :delete %>
  <% else %>
    <%= link_to 'Sign In', new_admin_session_path %>
  <% end %>
  <div class="col-6">
    <%= paginate @products %>
  </div>
  <div class="col-12">
    <div class="float-right">
      <%= link_to 'New Category', new_category_path %>
    </div>
  </div>
  <div>
    <% if admin_signed_in? %>
      <%= form_tag(products_csv_upload_path, multipart: true) do %>
        <%= file_field_tag(:csv_file) %>
        <%= submit_tag(:upload) %>
      <% end %>
    <% end %>
  </div>
  <div>
    <%= link_to products_path(format: :csv) do %>
      <%= button_tag('Download CSV', class: 'btn btn-primary float-right') %>
    <% end %>
  </div>
</div>